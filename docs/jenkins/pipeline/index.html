--- 
layout: default 
title: Elastest Documentation - Pipeline Jobs 
active: documentation 
section-title: Documentation 
section-icon: mdi mdi-content-copy 
---
<script src="/js/jquery-3.1.1.min.js"></script>
<script src="/js/float-panel.js"></script>

<script type="text/javascript">
	/* Import docs theme css */
	$('head').append('<link rel="stylesheet" type="text/css" href="/css/theme_extra.css">');
	

	$( document).ready(function(){
		$('#menu-list').show();
	    $('li.subnav_drop').find('ul.subnav').hide();
	       $( ".subnav" ).find( "li:contains('Pipeline Jobs')" ).each(function(i,e){
		  var currentElement = $(e);
		  currentElement.parent().css({"display":"block","visibility":"visible"}); //css("background-color","blue");
		  currentElement.css({"display":"block","visibility":"visible"});
	       });
	    $('li.subnav_drop').click(function(i,e) {  
	      $('li.subnav_drop').not(this).find('ul.subnav').hide();
	      $(this).find('ul.subnav').toggle();
	    }); 

	    var minHeight = $('#float-panel').outerHeight() + 100;	
						$('#doc-container').css('min-height', minHeight+'px');
	});
	   
	$( ".wy-nav-content" ).find( "li:contains('Pipeline Jobs')" ).css('color','red');
 </script>

<div id="doc-container" class="container text-justify">
  <div class="holder range"> 
        <div id="float-panel" class="wy-grid-for-nav cell-xs-3 cell-md-3 cell-lg-2 float-panel" data-top="56">

          
          <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
            <div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
		<div id="site-menu-title">
			<h3 class="h5">Explore docs</h3>
			<hr class="divider hr-lg-left-0 bg-orange">    
		</div>
		<ul id="menu-list" class="current" hidden>
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Getting started</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../..">What is ElasTest?</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../try-elastest/">Try ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../your-first-test/">Your first test with ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../support/">Get support from ElasTest team</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Testing with ElasTest</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/unit/">Run unit tests</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/e2e-rest/">Run end2end tests</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/sut/">Software under Test</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/parameterized-tests/">Parameterized tests</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../testing/multi-configuration-tjobs/">Multi-Configuration TJobs</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Web Browsers</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/manual-browsers/">Launching Web Browsers on ElasTest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/e2e-browser/">Run en2end tests with Web Browsers</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../web-browsers/outside-testing/">Testing with Web Browsers from outside ElasTest</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../log-analyzer/">Log Analyzer</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../executions-comparator/">Executions Comparator</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../testlink/">TestLink with ElasTest</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Test Monitoring</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/">Test Monitoring</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/outside-elastest/">Monitoring outside Elastest</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../monitoring/custom/">Custom monitoring</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Jenkins</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../">Jenkins integration</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../try-jenkins/">Try Jenkins plugin</a>
        
    </li>


        
             

    <li class="toctree-l1 current">
        <a class="current" href="./">Pipeline Jobs</a>
        
         
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../freestyle/">Freestyle Jobs</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Test Services</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../test-services/introduction/">Introduction</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../test-services/ebs/">Big Data Service (EBS)</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../test-services/ece/">Cost Engine (ECE)</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../test-services/eds/">Device Emulator Service (EDS)</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../test-services/ems/">Monitoring Service (EMS)</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../test-services/ere-trial/">Recommendation Manager - Trial (ERE)</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../test-services/ess/">Security Service (ESS)</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../testing/environment-variables/">Environment variables</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Deploying ElasTest</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../deploying/ubuntu/">Linux Server</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../deploying/aws/">Amazon Web Services</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../elastest-monitoring/">ElasTest Monitoring</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 
    
   
    <li class="subnav_drop"><span>Manage ElasTest</span>
<ul class="subnav">
        
             

    <li class="toctree-l1 ">
        <a class="" href="../../manage-elastest/monitoring-containers/">Monitoring Containers</a>
        
    </li>


        
             

    <li class="toctree-l1 ">
        <a class="" href="../../manage-elastest/manage-elasticsearch/">Manage Elasticsearch</a>
        
    </li>


        
</li>
</ul>
    
</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../releases/">Releases</a>
        
    </li>

</ul></li>
				
			
				
					<li><ul> 

    <li class="toctree-l1 ">
        <a class="" href="../../roadmap/">Roadmap</a>
        
    </li>

</ul></li>
				
			
		</ul>
            </div>
            &nbsp;
          </nav>
        </div>

	<section class="section-sm-41">
		<div class="shell">
		    <div class="range range-xs-right">
		        <div class="cell-xs-10 cell-sm-8 cell-md-9 cell-lg-10 cell-xl-12 text-md-left cell-lg-push-1 offset-lg-top-0">
			  
				<div class="wy-nav-content">
				  <div class="rst-content">
				   
				    <div role="main">
				      <div class="section">
					
					  <div class="range range-xs-left">
<div class="cell-xs-10 cell-lg-6 text-md-left inset-md-right-80 cell-lg-push-1 offset-top-50 offset-lg-top-0">
<h2 id="content" class="h1">Pipeline Jobs</h2>
<div class="offset-top-30 offset-md-top-30">
</div>
</div>
</div>

<p>If you already have some Jobs in your Jenkins CI Server or you want to create a new one, you might want to add the capabilities of ElasTest to get a greater amount of data from their executions and at the same time have the tools provided by elastest to ease their analysis. To do that, just have to wrap your main pipeline code with the <strong>elastest</strong> step.</p>
<pre><code>node {
    elastest() {
        ...The pipeline code...
    }
}
</code></pre>

<div class="range range-xs range-xs-center warning-range">
    <div class="cell-xs-2 cell-lg-1" style="text-align: center;"><span class="icon mdi mdi-information-outline warning-span"></span></div>
    <div class="cell-xs-10 cell-lg-11 warning-text"><p><i>NOTE: You can find more information about how integrate your current Jobs with ElasTest using the ElasTest plugin, below in <a href="#addElasTestToYourJob">this</a> document.</i></p></div>
</div>

<p>This step provides your pipeline with the following capabilities:</p>
<ul>
<li>Send the <strong><code>logs</code></strong> generated by a build to ElasTest.</li>
<li>Ask ElasTest for the <strong><code>browsers</code></strong> required by the tests executed during a build. The session of these browsers will be stored on ElasTest.</li>
<li>Monitoring docker services (send <strong><code>logs and metrics</code></strong> to ElasTest), such as dockerized <a href="../../testing/sut">Sut</a>, started during a build from a pipeline.</li>
<li>Associate a TJob to an existing project on ElasTest or to a new project with the name provided.</li>
<li>Ask ElasTest for a SUT managed by ElasTest (this SUT can be deployed by ElasTest or not)</li>
<li>Send the test results report to ElasTest.</li>
</ul>
<p>Let's see how to create some examples of Jenkins Job that use the plugin. If you are using the <a href="../../jenkins/">Jenkins integrated in ElasTest</a>, these examples are loaded by default and you will be able to run them directly without having to create them, but let's see their configurations to understand how to use the plugin.</p>
<h3 class="holder-subtitle link-top">Unit Test</h3>

<p>This Job will run the demo example <a href="https://github.com/elastest/demo-projects/tree/master/unit/junit5-unit-test">JUnit5 Unit Test</a>, which has a single class with two methods, sum and sub, that receive two numerical values to add or subtract respectively.
This test has been developed in Java using <a href="https://junit.org/junit5/">JUnit5</a>. The code of this project is explained in detail <a href="../../testing/unit">here</a></p>
<p>The <a href="https://jenkins.io/doc/book/pipeline/syntax/">Jenkins Pipeline code</a> that will contain the Job is as follows:</p>
<pre><code class="groovy">node{
    elastest(surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', project: 'Jenkins Examples') {
        stage ('Executing Test') {
            echo 'Set up test environment'
            mvnHome = tool 'M3.3.9'
            echo 'Cloning repository'
            git 'https://github.com/elastest/demo-projects'
            echo 'Run test'
            sh &quot;cd ./unit/junit5-unit-test;'${mvnHome}/bin/mvn' -B -DforkCount=0 test&quot;
            step([$class: 'JUnitResultArchiver', testResults: '**/target/surefire-reports/TEST-*.xml'])
        }
    }
}
</code></pre>

<p>The code above can be split into the following sections:</p>
<ul>
<li><strong>ElasTest plugin block with configuration</strong> : this block will contain all the steps that the test must follow, as well as the necessary <a href="#options">configuration options</a>.</li>
</ul>
<p></p>

<pre><code class="groovy">node{
    elastest(surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', project: 'Jenkins Examples') {
        .......
    }
}
</code></pre>

<p></p>

<ul>
<li><strong>Test Execution</strong> : Basically the following steps are followed:<ul>
<li>The <a href="https://github.com/elastest/demo-projects">GitHub repository</a> containing the tests is cloned. <strong><code>git 'https://github.com/elastest/demo-projects'</code></strong></li>
<li>You access the folder containing the tests: <strong><code>cd ./unit/junit5-unit-test</code></strong></li>
<li>The tests are executed: <strong><code>'${mvnHome}/bin/mvn' -B -DforkCount=0 test</code></strong></li>
</ul>
</li>
</ul>
<p></p>

<pre><code class="groovy">....
stage ('Executing Test') {
        echo 'Set up test environment'
        mvnHome = tool 'M3.3.9'
        echo 'Cloning repository'
        git 'https://github.com/elastest/demo-projects'
        echo 'Run test'
        sh &quot;cd ./unit/junit5-unit-test;'${mvnHome}/bin/mvn' -B -DforkCount=0 test&quot;
        step([$class: 'JUnitResultArchiver', testResults: '**/target/surefire-reports/TEST-*.xml'])
}
....
</code></pre>

<blockquote>
<p><strong>* This example will only work if the Maven tool is configured</strong></p>
</blockquote>
<p></p>

<p>To create this Job must <a href="../../jenkins/try-jenkins">access Jenkins</a>, create a Pipeline Job with the name you want (we'll use <strong>jenkins-junit5-unit-test</strong>), insert the code and save:</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-2" href="/docs/jenkins/images/pipeline/junit5_unit_test_pipeline_script.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/pipeline/junit5_unit_test_pipeline_script.png"/></a>
</div>

<p>Once created, you can execute it as follows:</p>
<h4 class="small-subtitle">1. Click to "Build now" button</h4>

<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/jenkins_junit_example_main_build_btn.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/jenkins_junit_example_main_build_btn.png"/></a>
</div>

<h4 class="small-subtitle">2. Running view</h4>

<p>After pressing the button, you will see the job running on Jenkins:</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/jenkins_junit_example_running.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/jenkins_junit_example_running.png"/></a>
</div>

<p>Entering the build page, you will see the Open in ElasTest button, where you can see the execution page in ElasTest (If the button does not appear refresh the page, it may take a while).</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/junit5_unit_test_build_et_icon.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/junit5_unit_test_build_et_icon.png"/></a>
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/elastest_junit_example_running.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/elastest_junit_example_running.png"/></a>
</div>

<p>ElasTest will have created a project called <strong><code>Jenkins Examples</code></strong> in <strong>Projects section</strong>, that will contain a <a href="../../#tjob">TJob</a> with the same name as Jenkins Job (jenkins-junit5-unit-test).</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/elastest_jenkins_project.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/elastest_jenkins_project.png"/></a>
</div>

<p>Navigating to this TJob you can see the current execution:</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/elastest_junit_example_running.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/elastest_junit_example_running.png"/></a>
</div>

<h4 class="small-subtitle">3. Results view</h4>

<p>Once the execution is complete, you can view it in both Jenkins and ElasTest</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/jenkins_junit_example_end.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/jenkins_junit_example_end.png"/></a>
</div>

<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/elastest_junit_example_end.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/elastest_junit_example_end.png"/></a>
</div>

<p>As can be seen in the last image, ElasTest shows different information, such as <strong>test results</strong> or <strong>logs</strong>. You can also see a card of metrics (All Metrics), but in this particular test is not sent any so it will appear empty.</p>
<p>You can also see the logs of both the entire execution and each of the test cases in <a href="../../log-analyzer">LogAnalyzer</a> by clicking on the corresponding buttons:</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/elastest_junit_example_loganalyzer.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/elastest_junit_example_loganalyzer.png"/></a>
    <a data-fancybox="gallery-1" href="/docs/jenkins/images/try/elastest_junit_example_testcase_loganalyzer.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/try/elastest_junit_example_testcase_loganalyzer.png"/></a>
</div>

<!-- ********************************** -->

<!-- ********** Rest Example ********** -->

<!-- ********************************** -->

<h3 class="holder-subtitle link-top">Rest Test (End2End)</h3>

<p>Bellow, you will find an example of pipeline where using the ElasTest plugin and implements severals configurations, a <a href="../../testing/sut">Sut</a> is started and a test is executed using it.
To configure this option, ElasTest provides the connection info using <a href="../../testing/environment-variables">environment variables</a>.</p>
<p>Here we will run our <a href="https://github.com/elastest/demo-projects/tree/master/rest/junit5-rest-test">JUnit5 Rest Test</a> provided by default in ElasTest, which makes use of a rest application as a SuT and has a single test that is responsible for making a GET request to that Sut. This test has been developed in Java using <a href="https://junit.org/junit5/">JUnit5</a>. The code of this project is explained in detail <a href="../../testing/e2e-rest">here</a>.</p>
<p>The <a href="https://jenkins.io/doc/book/pipeline/syntax/">Jenkins Pipeline code</a> that will contain the Job is as follows:</p>
<pre><code class="groovy">node{
    elastest(surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', monitoring: true, project: 'Jenkins Examples') {
        stage ('Executing Test') {
            def sutImage = docker.image('elastest/demo-rest-java-test-sut')
            echo 'Start SUT'
            def sutContainerName = env.ET_SUT_CONTAINER_NAME;
            sutImage.withRun(&quot;--name ${sutContainerName} --network=elastest_elastest&quot;) { c -&gt;
                echo &quot;${c.id}&quot;
                def sutNetwork = getFirstNetwork(sutContainerName)
                def sutIp = containerIp(sutContainerName,sutNetwork)
                sh 'docker run -e IP=' + sutIp + ' -e PORT=8080 --network=' + sutNetwork + ' elastest/etm-check-service-up'
                withEnv(['ET_SUT_HOST=' + sutIp]) {
                    echo 'Set up test environment'
                    mvnHome = tool 'M3.3.9'
                    echo 'Cloning repository'
                    git 'https://github.com/elastest/demo-projects'
                    echo 'Run test'
                    sh &quot;cd ./rest/junit5-rest-test;'${mvnHome}/bin/mvn' -B -DforkCount=0 test&quot;
                }
            }
        }
    }
}

def getFirstNetwork(containerName) {
    echo &quot;Inside getFirstNetwork function&quot;
    network = sh (
        script: &quot;docker inspect &quot; + containerName + &quot; -f \&quot;{{json .NetworkSettings.Networks}}\&quot; | awk \&quot;{sub(/:.*/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/\\\&quot;/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/\\\&quot;/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/{/,\\\&quot;\\\&quot;)}1\&quot;&quot;,
        returnStdout: true
    ).trim()

    echo containerName+&quot; Network = &quot; + network;
    return network;
}

def containerIp(containerName, network) {
    echo &quot;Inside containerIp function&quot;
    containerIp = sh (
        script: &quot;docker inspect --format=\&quot;{{.NetworkSettings.Networks.&quot; + network + &quot;.IPAddress}}\&quot; &quot;+ containerName,
        returnStdout: true
    ).trim()

    echo containerName+&quot; IP = &quot; + containerIp;
    return containerIp;
}
</code></pre>

<p>The example above can be split into the following sections:</p>
<ul>
<li><strong>ElasTest plugin block with configuration</strong> : this block will contain all the steps that the test must follow, as well as the necessary <a href="#options">configuration options</a>.</li>
</ul>
<p></p>

<pre><code class="groovy">node{
    elastest(surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', monitoring: true, project: 'Jenkins Examples') {
        .......
    }
}
</code></pre>

<p></p>

<ul>
<li><strong>Sut configuration</strong> : The SUT must be started, passing the <strong><code>${env.ET_SUT_CONTAINER_NAME}</code></strong> env variable (provided by ElasTest) as name of the container. This will allow ElasTest to receive logs and metrics from the Sut.</li>
</ul>
<p></p>

<pre><code class="groovy">def sutImage = docker.image('elastest/demo-rest-java-test-sut')
echo 'Start SUT'
def sutContainerName = env.ET_SUT_CONTAINER_NAME;
sutImage.withRun(&quot;--name ${sutContainerName} --network=elastest_elastest&quot;) { c -&gt;
</code></pre>

<p></p>

<ul>
<li><strong>Wait for Sut</strong> : You have to obtain the Sut network and ip and run check image (elastest/etm-check-service-up) provided by ElasTest to wait for the Sut to be ready to be used. This step is not required, you can wait in other ways or not do it, but for this example we do it.
    <p></p></li>
</ul>
<pre><code class="groovy">def sutNetwork = getFirstNetwork(sutContainerName)
def sutIp = containerIp(sutContainerName,sutNetwork)
sh 'docker run -e IP=' + sutIp + ' -e PORT=8080 --network=' + sutNetwork + ' elastest/etm-check-service-up'
</code></pre>

<p></p>

<ul>
<li><strong>Test Execution</strong> : Finally, the tests should be executed to verify that the SUT is working correctly. Remember that you have to configure the Sut ip as an environment variable or pass it as a maven property so that the test knows where the SUT is.</li>
</ul>
<p></p>

<pre><code class="groovy">....
withEnv(['ET_SUT_HOST=' + sutIp]) {
    echo 'Set up test environment'
    mvnHome = tool 'M3.3.9'
    echo 'Cloning repository'
    git 'https://github.com/elastest/demo-projects'
    echo 'Run test'
    sh &quot;cd ./rest/junit5-rest-test;'${mvnHome}/bin/mvn' -B -DforkCount=0 test&quot;
}
....
</code></pre>

<blockquote>
<p><strong>* This example will only work if the Maven tool is configured</strong></p>
</blockquote>
<!-- ********************************** -->

<!-- ******* WebBrowser Example ******* -->

<!-- ********************************** -->

<h3 class="holder-subtitle link-top">WebBrowser Example</h3>

<p>Bellow, you will find an example of pipeline where using the ElasTest plugin and implements severals configurations, a <a href="../../testing/sut">Sut</a> is started and a test battery is executed using it, making use of WebBrowsers.
To configure this option, ElasTest provides the connection info using <a href="../../testing/environment-variables">environment variables</a>.</p>
<p>Here we will run our <a href="https://github.com/elastest/demo-projects/tree/master/webapp/junit5-web-multiple-browsers-test">JUnit5 Multi Browser Test</a> provided by default in ElasTest, which makes use of a Spring Boot Application as a SuT that has two input fields (title and body) and a button to add them as a table row. Also has three test that are responsible for add rows to that Sut and verify that the added row has the expected content.
This test has been developed in Java using <a href="https://junit.org/junit5/">JUnit5</a>. The code of this project is explained in detail <a href="../../web-browsers/e2e-browser">here</a>.</p>
<p>The <a href="https://jenkins.io/doc/book/pipeline/syntax/">Jenkins Pipeline code</a> that will contain the Job is as follows:</p>
<pre><code class="groovy">node{
    elastest(tss: ['EUS'], surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', monitoring: true, project: 'Jenkins Examples') {
        stage ('Executing Test') {
            echo 'Print env variables'
            sh 'env'
            def sutImage = docker.image('elastest/demo-web-java-test-sut')
            echo 'Start SUT'
            sutImage.withRun(&quot;--name ${env.ET_SUT_CONTAINER_NAME}&quot;) { c -&gt;
                echo &quot;${c.id}&quot;
                def sutContainerName = env.ET_SUT_CONTAINER_NAME;
                def sutNetwork = getFirstNetwork(sutContainerName)
                def sutIp = containerIp(sutContainerName,sutNetwork)
                sh 'docker run -e IP=' + sutIp + ' -e PORT=8080 --network=' + sutNetwork + ' elastest/etm-check-service-up'
                withEnv(['ET_SUT_HOST=' + sutIp]) {
                    echo 'Set up test environment'
                    mvnHome = tool 'M3.3.9'
                    echo 'Cloning repository'
                    git 'https://github.com/elastest/demo-projects'
                    echo 'Run test'
                    sh &quot;cd ./webapp/junit5-web-multiple-browsers-test/;'${mvnHome}/bin/mvn' -Dbrowser=chrome -DforkCount=0 test&quot;
                }
            }

        }
    }
}

def getFirstNetwork(containerName) {
    echo &quot;Inside getFirstNetwork function&quot;
    network = sh (
        script: &quot;docker inspect &quot; + containerName + &quot; -f \&quot;{{json .NetworkSettings.Networks}}\&quot; | awk \&quot;{sub(/:.*/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/\\\&quot;/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/\\\&quot;/,\\\&quot;\\\&quot;)}1\&quot; | awk \&quot;{sub(/{/,\\\&quot;\\\&quot;)}1\&quot;&quot;,
        returnStdout: true
    ).trim()

    echo containerName+&quot; Network = &quot; + network;
    return network;
}

def containerIp(containerName, network) {
    echo &quot;Inside containerIp function&quot;
    containerIp = sh (
        script: &quot;docker inspect --format=\&quot;{{.NetworkSettings.Networks.&quot; + network + &quot;.IPAddress}}\&quot; &quot;+ containerName,
        returnStdout: true
    ).trim()

    echo containerName+&quot; IP = &quot; + containerIp;
    return containerIp;
}
</code></pre>

<p>The example above can be split into the following sections:</p>
<ul>
<li><strong>ElasTest plugin block with configuration</strong> : this block will contain all the steps that the test must follow, as well as the necessary <a href="#options">configuration options</a>.</li>
</ul>
<p></p>

<pre><code class="groovy">node{
    elastest(tss: ['EUS'], surefireReportsPattern: '**/target/surefire-reports/TEST-*.xml', monitoring: true, project: 'Jenkins Examples') {
        .......
    }
}
</code></pre>

<p></p>

<ul>
<li><strong>Sut configuration</strong> : The SUT must be started, passing the <strong><code>${env.ET_SUT_CONTAINER_NAME}</code></strong> env variable (provided by ElasTest) as name of the container. This will allow ElasTest to receive logs and metrics from the Sut.
    <p></p></li>
</ul>
<pre><code class="groovy">def sutImage = docker.image('elastest/demo-web-java-test-sut')
echo 'Start SUT'
sutImage.withRun(&quot;--name ${env.ET_SUT_CONTAINER_NAME}&quot;) { c -&gt;
</code></pre>

<p></p>

<ul>
<li><strong>Wait for Sut</strong> : You have to obtain the Sut network and ip and run check image (elastest/etm-check-service-up) provided by ElasTest to wait for the Sut to be ready to be used.
    <p></p></li>
</ul>
<pre><code class="groovy">def sutContainerName = env.ET_SUT_CONTAINER_NAME;
def sutNetwork = getFirstNetwork(sutContainerName)
def sutIp = containerIp(sutContainerName,sutNetwork)
sh 'docker run -e IP=' + sutIp + ' -e PORT=8080 --network=' + sutNetwork + ' elastest/etm-check-service-up'ocker run -e IP=' + sutIp + ' -e PORT=8080 --network=' + sutNetwork + ' elastest/etm-check-service-up'
</code></pre>

<p></p>

<ul>
<li><strong>Test Execution</strong> : Finally, the tests should be executed to verify that the SUT is working correctly. Remember that you have to configure the Sut ip as an environment variable or pass it as a maven property so that the test and the browsers we are going to use know where the Sut is located.</li>
</ul>
<p></p>

<pre><code class="groovy">....
withEnv(['ET_SUT_HOST=' + sutIp]) {
    echo 'Set up test environment'
    mvnHome = tool 'M3.3.9'
    echo 'Cloning repository'
    git 'https://github.com/elastest/demo-projects'
    echo 'Run test'
    sh &quot;cd ./webapp/junit5-web-multiple-browsers-test/;'${mvnHome}/bin/mvn' -Dbrowser=chrome -DforkCount=0 test&quot;
}
....
</code></pre>

<blockquote>
<p><strong>* This example will only work if the Maven tool is configured</strong></p>
</blockquote>
<!-- ************************************* -->

<!-- ****** ElasTest Plugin options ****** -->

<!-- ************************************* -->

<h3 class="holder-subtitle link-top" id="options">ElasTest Plugin options</h3>

<p>The installation of ElasTest, Jenkins and the collaboration between them, allows several configurations and offers the following options:</p>
<ul>
<li><strong><code>surefireReportsPattern</code></strong> will contain the path where the xml files containing the test results are stored and which will be used by ElasTest to display the test information. We explain this in more detail <a href="/docs/testing/unit#xmlAndtestResultsPath">here</a>.</li>
<li><strong><code>project</code></strong> is used to indicate the name of the ElasTest project where the TJob associated with Jenkins Job will be created. This field is optional and if it is not used, a project will be created with the same name as the Job.</li>
<li><strong><code>sut</code></strong>: allows you to select a Sut created in ElasTest against which to execute the job, indicating its id.</li>
<li><strong><code>tss: ['EUS']</code></strong>: is used to indicate to ElasTest that the job needs to use the EUS service to use a web browser.</li>
<li><strong><code>monitoring</code></strong>: used to send or not the Sut monitoring traces to Elastest.</li>
<li><strong><code>sutParams: ['PARAM_NAME': 'value']</code></strong>: used to send parameters to Sut.</li>
</ul>
<!-- ************************************** -->

<!-- ************ Add ElasTest ************ -->

<!-- ************************************** -->

<h3 id="addElasTestToYourJob" class="holder-subtitle link-top">Add ElasTest to your current Jenkins Jobs</h3>

<div class="range range-xs range-xs-center warning-range">
    <div class="cell-xs-2 cell-lg-1" style="text-align: center;"><span class="icon mdi mdi-information-outline warning-span"></span></div>
    <div class="cell-xs-10 cell-lg-11 warning-text"><p><i>We are preparing improvements and new features in the ElasTest Jenkins plugin for the next release.</i></p></div>
</div>

<h4 class="small-subtitle">1. Identify your <strong class="etColor">test types</strong>:</h4>

<ul>
<li>Unit</li>
<li>Rest</li>
<li>WebBrowsers</li>
</ul>
<h4 class="small-subtitle" id="modifyYourCode">2. Modify your <strong class="etColor">code</strong>:</h4>

<h5 id="unit"><strong>Unit</strong></h5>
<p>For Unit Tests no modification is necessary to make it work but if you want ElasTest to be able to differentiate the logs of each of the test cases, it is necessary to add a start/finish log trace in each one. This is explained in detail <a href="../../testing/unit#xmlAndtestResultsPath">here</a>.</p>
<h5 id="rest"><strong>Rest</strong></h5>
<p>For Rest Tests no modification is necessary to make it work but if you want ElasTest to be able to differentiate the logs of each of the test cases, it is necessary to add a start/finish log trace in each one. This is explained in detail <a href="../../testing/unit#xmlAndtestResultsPath">here</a>.</p>
<h5 id="webbrowsers"><strong>WebBrowsers</strong></h5>
<p>You will need to make use of the <strong><code>ET_EUS_API</code></strong> <a href="../../testing/environment-variables">environment variable</a> provided by ElasTest to manage the browsers that the test will use. For example, if you use <em>Selenium RemoteWebDriver</em>, the code should be similar to the following:</p>
<pre><code class="java">String eusURL = System.getenv(&quot;ET_EUS_API&quot;);
WebDriver driver = new RemoteWebDriver(new URL(eusURL), caps);
</code></pre>

<h4 class="small-subtitle">3. Modify your <strong class="etColor">Jenkinsfile</strong>:</h4>

<p>For any type of test you need to make use of the step <strong><code>elastest()</code></strong> and enclose your code in it:</p>
<pre><code class="groovy">node{
    elastest() {
        .... YOUR CODE HERE ...
    }
}
</code></pre>

<p>If your tests generate <a href="../../testing/unit#xmlAndtestResultsPath">xml report files</a> (as JUnit does for example) you can use <a href="#options">option</a> <strong><code>surefireReportsPattern</code></strong> to indicate the path where they will be generated, so ElasTest can use them to get information:</p>
<pre><code class="groovy">node{
    elastest(surefireReportsPattern: '**/path/to/report/files/*.xml') {
        .... YOUR CODE HERE ...
    }
}
</code></pre>

<p>If you are using <strong>Unit Test this is all you need to modify</strong>. Let's see what changes are needed for the rest of the cases:</p>
<h5 id="if-you-use-a-sut"><strong>If you use a Sut</strong></h5>
<p>Depending on <strong>how you start the Sut</strong>, you will have to make different modifications:</p>
<ul>
<li>If your application is a Docker container started with <strong><code>docker run</code></strong> you will need to modify the command to give the <strong>container a name</strong>. This name will be the value of the <strong><code>ET_SUT_CONTAINER_NAME</code></strong> <a href="../../testing/environment-variables">environment variable</a> provided by ElasTest:
<p></p></li>
</ul>
<pre><code class="groovy">def sutImage = docker.image('your-image')
def sutContainerName = env.ET_SUT_CONTAINER_NAME;
sutImage.withRun(&quot;--name ${sutContainerName}&quot;) { c -&gt;
    ....
}
</code></pre>

<p></p>

<ul>
<li>If your application is started with a <strong><code>docker-compose</code></strong> you will need to modify the command to set a <strong>project name</strong>. This name will be the value of the <strong><code>ET_SUT_CONTAINER_NAME</code></strong> <a href="../../testing/environment-variables">environment variable</a> provided by ElasTest:
<p></p></li>
</ul>
<pre><code class="groovy">sh &quot;docker-compose -p ${env.ET_SUT_CONTAINER_NAME} up -d&quot;
</code></pre>

<p></p>

<ul>
<li>If your application starts <strong><code>directly from the code</code></strong> (like for example with java -jar command) or is started on an <strong><code>external machine</code></strong> you don't have to do anything, but in this case the Sut logs will be part of the TJob logs.</li>
</ul>
<p></p>

<p>Whether your application is a <strong>docker container</strong> or <strong>docker-compose</strong>, you can use the <strong><code>monitoring: true</code></strong> <a href="#options">option</a> so that ElasTest is able to receive metrics from the Sut.</p>
<pre><code class="groovy">elastest(monitoring: true, ...other options...) {
        ....
}
</code></pre>

<h5 id="if-you-use-a-webbrowsers"><strong>If you use a WebBrowsers</strong></h5>
<p>If you use WebBrowsers in your tests, it is necessary to use the <a href="#options">option</a> <strong><code>tss: ['EUS']</code></strong>:</p>
<pre><code class="groovy">elastest(tss: ['EUS'], ...other options...) {
        ....
}
</code></pre>

<p>Thanks to this option, ElasTest will be in charge of <strong>managing the browsers</strong>, <strong>recording</strong> the tests and <strong>associating the videos</strong> to them, as well as sending the logs of the browsers console. It also initializes <a href="../../testing/environment-variables">environment variable</a> <strong>ET_EUS_API</strong> that we mentioned in the step <a href="#modifyYourCode">Modify your code</a> and that you need to use in the code of your tests.</p>
<!-- ************************************** -->

<!-- ************ Limit Builds ************ -->

<!-- ************************************** -->

<h3 id="limitBuilds" class="holder-subtitle link-top">Setting max nÂº of builds</h3>

<p>If in your Jenkins job you check the <strong>Discard old builds</strong> option and set a value for <strong>Max # of builds to keep</strong>, it will also be set in ElasTest, saving only the last N runs.</p>
<div class="docs-gallery inline-block">
    <a data-fancybox="gallery-2" href="/docs/jenkins/images/pipeline/max_builds.png"><img class="img-responsive img-wellcome" src="/docs/jenkins/images/pipeline/max_builds.png"/></a>
</div>

<!-- ************************************** -->

<!-- ************ Known Issues ************ -->

<!-- ************************************** -->

<h3 class="holder-subtitle link-top">Jenkins deployment known issues</h3>

<ul>
<li>If ElasTest and Jenkins are on <strong>different machines</strong> and Jenkins starts a Sut, it must have its <strong>public IP</strong> so that ElasTest browsers can access it.</li>
</ul>
					
				      </div>
				    </div>
				    <footer>
<hr class="divider divider-100 divider-xs hr-lg-center-0 offset-xs-top-20 offset-sm-top-20 offset-md-top-20 offset-lg-top-20">
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../freestyle/" class="btn btn-xs btn-primary float-right" title="Freestyle Jobs">Next &raquo;<span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../try-jenkins/" class="btn btn-xs btn-primary" title="Try Jenkins plugin"><span class="icon icon-circle-arrow-left"></span> &laquo; Prev</a>
      
    </div>
  


  
  
	  <a href="https://github.com/elastest/elastest.io-docs/blob/master/docs/jenkins/pipeline.md" class="fa fa-github offset-xxs-top-30"> Edit Documentation on GitHub</a>
  
</footer>
			  	  
				  </div>
				</div>
			</div>
		    </div>
		</div>
	</section>

  </div>
</div>

<!-- Gallery -->
<script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js"></script>

<script>
var galleries = $('div.docs-gallery');
for (var i = 1; i <= galleries.length; i++) {
    $().fancybox({
    selector : '[data-fancybox="gallery-' + i + '"]',
    infobar : true,
    arrows : false,
    loop: false,
    protect: true,
    transitionEffect: 'slide',
    buttons : [
        'close'
    ],
    clickOutside : 'close',
    clickSlide   : 'close',
  });
}
</script>
